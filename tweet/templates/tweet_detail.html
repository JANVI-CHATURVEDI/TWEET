{% extends "layout.html" %}
{% load tweet_tags %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Tweet{% endblock %}

{% block content %}
<div class="w-full mt-5 p-6 bg-[#1a1a1a] border border-[#2a2a2a] rounded-2xl shadow-xl ">

    <!-- Tweet header -->
    <div class="flex justify-between items-center mb-4">
        <div class="flex  gap-3 items-center">
            <!-- Avatar -->
            {% if tweet.user.profile.avatar %}
                    <img src="{{ tweet.user.profile.avatar.url }}" 
                         alt="{{ tweet.user.username }}'s avatar"
                         class="w-12 h-12 rounded-full object-cover flex-shrink-0 border border-[#333]">
            {% else %}
                    <img src="{% static 'images/pfp-default.jfif' %}" 
                         alt="Default avatar"
                         class="w-12 h-12 rounded-full object-cover flex-shrink-0 border border-[#333]">
            {% endif %}

            <p class="text-white font-semibold">{{ tweet.user.username }}</p>
            <p class="text-gray-400 text-sm">{{ tweet.created_at|date:"M d, Y H:i" }}</p>
        </div>

        {% if user == tweet.user %}
        <div class="flex gap-2">
            <a href="{% url 'tweet_edit' tweet.pk %}" 
               class="px-3 py-1 bg-white text-black rounded-lg font-medium hover:bg-gray-200 text-sm transition">
                Edit
            </a>
            <form method="POST" action="{% url 'tweet_delete' tweet.pk %}" 
                  onsubmit="return confirm('Are you sure you want to delete this tweet?');">
                {% csrf_token %}
                <button type="submit" 
                        class="px-3 py-1 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 text-sm transition">
                    Delete
                </button>
            </form>
        </div>
        {% endif %}
    </div>

    <!-- Tweet content -->
    <p class="text-gray-200 mb-4 text-lg break-words">{{ tweet.text|render_hashtags|safe }}</p>

    {% if tweet.photo %}
        <img src="{{ tweet.photo.url }}" 
             alt="Tweet Photo" 
             class="w-full max-h-[60vh] object-cover rounded-md mb-4 border border-gray-700">
    {% endif %}

    <!-- Actions: Likes / Reposts -->
    <div class="flex items-center gap-8 mb-6">
        <form method="POST" action="{% url 'like_tweet' tweet.pk %}">
            {% csrf_token %}
            <button type="submit" class="flex items-center gap-1 hover:text-red-500 transition group">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="w-5 h-5 group-hover:scale-110 transition"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 116.364 6.364L12 20.364 4.318 12.682a4.5 4.5 0 010-6.364z"/>
                </svg>
                <span>{{ tweet.likes.count }}</span>
            </button>
                            
        </form>

        <!-- Repost button -->
        <form method="POST" action="{% url 'repost_tweet' tweet.pk %}">
            {% csrf_token %}
            <button type="submit" class="flex items-center gap-1 hover:text-green-400 transition group">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="w-5 h-5 group-hover:scale-110 transition"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M4 4v6h6M20 20v-6h-6"/>
                </svg>
                <span>{{ tweet.reposts.count }}</span>
            </button>
            
        </form>
    </div>

    <!-- Comments section -->
    <div class="mb-4">
        <h3 class="text-gray-300 font-semibold mb-3">Comments</h3>

        {% for comment in comments %}
            <div class="flex items-start gap-3 mb-3 p-3 bg-gray-800 rounded-lg border border-gray-700">
                
                <!-- Avatar -->
                {% if comment.user.profile.avatar %}
                    <img src="{{ comment.user.profile.avatar.url }}" 
                         alt="{{ comment.user.username }}" 
                         class="w-10 h-10 rounded-full object-cover border border-gray-600">
                {% else %}
                    <img src="{% static 'images/default-avatar.png' %}" 
                         alt="Default Avatar" 
                         class="w-10 h-10 rounded-full object-cover border border-gray-600">
                {% endif %}
                
                <!-- Comment content -->
                <div>
                    <p class="text-white font-medium">{{ comment.user.username }}</p>
                    <p class="text-gray-300 break-words">{{ comment.text }}</p>
                </div>
            </div>
        {% empty %}
            <p class="text-gray-500 text-sm">No comments yet.</p>
        {% endfor %}
    </div>

    <!-- Add comment form -->
    <form method="POST" class="flex gap-2">
        {% csrf_token %}
        {{ form.text|add_class:"flex-1 px-3 py-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400" }}
        <button type="submit" 
                class="px-4 py-2 bg-white text-black rounded-lg font-medium hover:bg-gray-200 transition">
            Comment
        </button>
    </form>

    <!-- Back button -->
    <a href="{% url 'tweet_list' %}" 
       class="block mt-6 py-2 px-4 bg-white text-black text-center rounded-lg  transition">
        ‚Üê Back to List
    </a>
</div>
{% endblock %}
