{% extends "layout.html" %}
{% load tweet_tags %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Tweets{% endblock %}

{% block content %}

    <h2 class="text-white text-xl font-semibold mb-6">Tweets tagged with #{{ tag.name }}</h2>

    {% if tweets_tagged %}
        {% for tweet in tweets_tagged %}
            <div class="bg-[#121111] border border-[#2a2a2a] rounded-xl p-4 hover:bg-[#1e1e1e] transition">

            {% if tweet.reposted_from %}
                <div class="text-gray-400 text-xs  flex items-center gap-1 mb-3.5">
                    üîÅ {{ tweet.user.username }} reposted from {{ tweet.reposted_from.user.username }}
                </div>
            {% endif %}

            <div class="flex items-start gap-3">
                <!-- Profile avatar -->
                {% if tweet.user.profile.avatar %}
                    <img src="{{ tweet.user.profile.avatar.url }}" 
                         alt="{{ tweet.user.username }}'s avatar"
                         class="w-12 h-12 rounded-full object-cover flex-shrink-0 border border-[#333]">
                {% else %}
                    {# Use a default static avatar if user has none #}
                    <img src="{% static 'images/default-avatar.png' %}" 
                         alt="Default avatar"
                         class="w-12 h-12 rounded-full object-cover flex-shrink-0 border border-[#333]">
                {% endif %}

                <div class="flex-1 min-w-0">
                    <!-- Username + date -->
                    <div class="flex items-center gap-2 text-sm flex-wrap">
                        <span class="font-semibold text-white">{{ tweet.user.username }}</span>
                        <span class="text-gray-500">¬∑ {{ tweet.created_at|date:"M d, Y H:i" }}</span>
                    </div>

                    <!-- Tweet text -->
                    {% if tweet.text|wordcount > 15 %}
                        <p class="text-gray-300 mt-1 leading-snug break-words">
                            {{ tweet.text|truncatewords:35|render_hashtags|safe }}...
                            <a href="{% url 'tweet_detail' tweet.id %}" class="text-blue-200 hover:underline">Show more</a>
                        </p>
                    {% else %}
                        <p class="text-gray-300 mt-1 leading-snug break-words">
                            {{ tweet.text|render_hashtags|safe }}
                        </p>
                    {% endif %}                    

                    

                    <!-- Tweet image -->
                    {% if tweet.photo %}
                        <img src="{{ tweet.photo.url }}" 
                             alt="Tweet photo" 
                             class="mt-3 rounded-lg max-w-full max-h-96 object-cover border border-[#333]">
                    {% endif %}

                    <!-- Actions: Likes / Reposts / Comment icon -->
                    <div class="flex items-center gap-6 mt-3 pt-3 border-t border-[#333] text-gray-500 text-sm">
                        <!-- Like button -->
                        <form method="POST" action="{% url 'like_tweet' tweet.pk %}">
                            {% csrf_token %}
                            <button type="submit" class="flex items-center gap-1 hover:text-red-500">
                                ‚ù§Ô∏è <span>{{ tweet.likes.count }}</span>
                            </button>
                        </form>

                        <!-- Repost button -->
                        <form method="POST" action="{% url 'repost_tweet' tweet.pk %}">
                            {% csrf_token %}
                            <button type="submit" class="flex items-center gap-1 hover:text-green-400">
                                üîÅ <span>{{ tweet.reposts.count }}</span>
                            </button>
                        </form>

                        <!-- Comment icon -->
                        <a href="{% url 'tweet_detail' tweet.pk %}#comments" class="flex items-center gap-1 hover:text-blue-400">
                            üí¨ <span>{{ tweet.comments.count }}</span>
                        </a>

                        {% if tweet.user == user %}
                            <a href="{% url 'tweet_delete' tweet.id %}" 
                               class="flex items-center gap-1 hover:text-red-500">üóë Delete</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-gray-500">No tweets found for this tag.</p>
    {% endif %}

    <!-- Back to all tweets -->
    <a href="{% url 'tweet_list' %}" 
       class="block mt-6 py-2 px-4 bg-white text-black text-center rounded-lg transition">
        ‚Üê Back to all Tweets
    </a>


{% endblock %}
