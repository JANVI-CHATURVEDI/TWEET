{% extends "layout.html" %}
{% load widget_tweaks %}

{% block title %}Tweets{% endblock title %}

{% block content %}
<div class="flex flex-col space-y-4 max-w-2xl mx-auto px-2">

    {% for tweet in tweets %}
        <div class="bg-[#121111] border border-[#2a2a2a] rounded-xl p-4 hover:bg-[#1e1e1e] transition">

            {% if tweet.reposted_from %}
                <div class="text-gray-400 text-xs mb-1 flex items-center gap-1 mb-3.5">
                    üîÅ {{ tweet.user.username }} reposted from {{ tweet.reposted_from.user.username }}
                </div>
            {% endif %}

            <div class="flex items-start gap-3">
                <!-- Profile avatar -->
                {% if tweet.user.profile.avatar %}
                    <img src="{{ tweet.user.profile.avatar.url }}" 
                         alt="{{ tweet.user.username }}'s avatar"
                         class="w-12 h-12 rounded-full object-cover flex-shrink-0 border border-[#333]">
                {% else %}
                    <div class="w-12 h-12 rounded-full bg-gray-700 flex-shrink-0 flex items-center justify-center text-white font-bold">
                        {{ tweet.user.username|slice:":1" }}
                    </div>
                {% endif %}

                <div class="flex-1 min-w-0">
                    <!-- Username + date -->
                    <div class="flex items-center gap-2 text-sm flex-wrap">
                        <span class="font-semibold text-white">{{ tweet.user.username }}</span>
                        <span class="text-gray-500">¬∑ {{ tweet.created_at|date:"M d, Y H:i" }}</span>
                    </div>

                    <!-- Tweet text -->
                    {% if tweet.text|wordcount > 15 %}
                        <p class="text-gray-300 mt-1 leading-snug break-words">
                            {{ tweet.text|truncatewords:15 }}...
                            <a href="{% url 'tweet_detail' tweet.id %}" class="text-blue-500 hover:underline">Show more</a>
                        </p>
                    {% else %}
                        <p class="text-gray-300 mt-1 leading-snug break-words">
                            {{ tweet.text }}
                        </p>
                    {% endif %}

                    <!-- Tweet image -->
                    {% if tweet.photo_url %}
                        <img src="{{ tweet.photo_url }}" 
                             alt="Tweet photo" 
                             class="mt-3 rounded-lg max-w-full max-h-96 object-cover border border-[#333]">
                    {% endif %}

                    <!-- Actions: Likes / Reposts / Comment icon -->
                    <div class="flex items-center gap-6 mt-3 pt-3 border-t border-[#333] text-gray-500 text-sm">
                        <!-- Like button (inline) -->
                        <form method="POST" action="{% url 'like_tweet' tweet.pk %}">
                            {% csrf_token %}
                            <button type="submit" class="flex items-center gap-1 hover:text-red-500">
                                ‚ù§Ô∏è <span>{{ tweet.likes.count }}</span>
                            </button>
                        </form>

                        <!-- Repost button (inline) -->
                        <form method="POST" action="{% url 'repost_tweet' tweet.pk %}">
                            {% csrf_token %}
                            <button type="submit" class="flex items-center gap-1 hover:text-green-400">
                                üîÅ <span>{{ tweet.reposts.count }}</span>
                            </button>
                        </form>

                        <!-- Comment icon: leads to detail page -->
                        <a href="{% url 'tweet_detail' tweet.pk %}#comments" class="flex items-center gap-1 hover:text-blue-400">
                            üí¨ <span>{{ tweet.comments.count }}</span>
                        </a>

                        {% if tweet.user == user %}
                            <a href="{% url 'tweet_delete' tweet.id %}" 
                               class="flex items-center gap-1 hover:text-red-500">üóë Delete</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}

</div>
{% endblock %}
