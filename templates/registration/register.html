{% extends "layout.html" %}
{% load widget_tweaks %}
{% load static %}

{% block content %}
<div class="max-w-sm mx-auto mt-10 p-6 bg-black rounded-xl shadow-lg border border-neutral-800">
    <h2 class="text-2xl font-bold mb-6 text-white text-center">Register</h2>

    <form method="post" enctype="multipart/form-data" class="space-y-4">
        {% csrf_token %}
        {% for field in form %}
        <div class="flex flex-col">
            <label for="{{ field.id_for_label }}" class="mb-1 text-neutral-300">{{ field.label }}</label>

            {% if field.name == "avatar" %}
            <div class="flex items-center gap-3">
                <!-- Avatar preview -->
                <img id="avatarPreview" src="{% static 'default-avatar.png' %}" 
                     class="w-12 h-12 rounded-full object-cover border border-neutral-700"
                     alt="Preview">

                <!-- File input -->
                {{ field|add_class:"block w-full text-sm text-neutral-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:font-semibold file:bg-white file:text-black hover:file:bg-neutral-200 cursor-pointer" }}
            </div>
            <p class="text-neutral-400 text-xs mt-1">Upload a profile picture (optional)</p>
            {% else %}
            {{ field|add_class:"px-3 py-2 rounded bg-black text-white border border-neutral-700 focus:outline-none focus:ring-2 focus:ring-white transition" }}
            {% endif %}

            {% if field.errors %}
            <p class="text-red-500 text-sm mt-1">{{ field.errors|striptags }}</p>
            {% endif %}
        </div>
        {% endfor %}

        <button type="submit" class="w-full py-2 bg-white text-black rounded font-semibold hover:bg-neutral-200 transition">
            Register
        </button>
    </form>

    <p class="mt-4 text-neutral-400 text-center text-sm">
        Already have an account?
        <a href="{% url 'login' %}" class="text-white hover:underline">Login here</a>
    </p>
</div>

<!-- Avatar Preview Script -->
<script>
    const avatarInput = document.querySelector('input[name="avatar"]');
    const avatarPreview = document.getElementById('avatarPreview');

    if (avatarInput) {
        avatarInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                avatarPreview.src = URL.createObjectURL(file);
            } else {
                avatarPreview.src = "{% static 'default-avatar.png' %}";
            }
        });
    }
</script>
{% endblock %}
